machine:
  node:
    version: 4.2.6

general:
  branches:
    only:
      - master
      - beta

dependencies:
  override:
    - npm install npm@latest -g
    - npm install angular-cli@1.0.0-beta.26 -g
    - npm install
    - npm ls

test:
  override:
    - echo "skipped, do nothing."


deployment:
  #the following commands deploy to the beta.capsulecd.com domain.
  beta:
    branch: beta
    commands:
      - ng github-pages:deploy --message "Autodeploy gh-pages" --base-href "/" --dev

  # the following command deploys to www.capsulecd.com domain if the change is made on the master branch.
  production:
    branch: master
    commands:
      - ls
      - pwd
      - ls /
      - ng build --prod --sourcemap --output-path ../dist --base-href "/"
      - cp ../dist/angular.html ../dist/404.html
      - echo "www.quietthyme.com" > ../dist/CNAME
      - cd ../dist && git init && git add . && git commit -m "Deploy"
      - cd ../dist && git remote add origin git@github.com:AnalogJ/quietthyme-web.git
      - cd ../dist && git push --force origin master:gh-pages